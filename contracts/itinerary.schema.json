{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://urbanmanual/contracts/itinerary.schema.json",
  "title": "Urban Manual Itinerary Contract",
  "description": "Schema shared between the Next.js frontend and the ML service for itinerary optimization requests and responses.",
  "$defs": {
    "DestinationId": {
      "type": "integer",
      "minimum": 1,
      "description": "Primary key for a destination."
    },
    "ItineraryPlace": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": { "$ref": "#/$defs/DestinationId" },
        "name": { "type": "string", "minLength": 1 },
        "category": { "type": "string", "minLength": 1 },
        "lat": { "type": ["number", "null"], "minimum": -90, "maximum": 90 },
        "lng": { "type": ["number", "null"], "minimum": -180, "maximum": 180 },
        "score": { "type": ["number", "null"] },
        "distance_km": { "type": ["number", "null"], "minimum": 0 },
        "weight": { "type": ["number", "null"], "minimum": 0 },
        "frequency": { "type": ["number", "null"], "minimum": 0 },
        "reason": { "type": ["string", "null"] }
      },
      "required": ["id", "name"],
      "description": "Destination enriched with optimization metadata."
    },
    "ItineraryDay": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "day": { "type": "integer", "minimum": 1 },
        "places": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/ItineraryPlace" }
        }
      },
      "required": ["places"],
      "description": "Collection of places assigned to a calendar day."
    },
    "ItineraryOptimizationRequest": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "destination_ids": {
          "type": "array",
          "minItems": 1,
          "maxItems": 100,
          "items": { "$ref": "#/$defs/DestinationId" },
          "uniqueItems": true,
          "description": "Destination IDs that must be included in the optimization."
        },
        "max_days": {
          "type": "integer",
          "minimum": 1,
          "maximum": 7,
          "default": 3,
          "description": "Upper bound on the number of days to allocate."
        }
      },
      "required": ["destination_ids"],
      "description": "Request payload for the /api/graph/optimize-itinerary endpoint."
    },
    "ItineraryOptimizationResponse": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "days": {
          "type": "array",
          "items": { "$ref": "#/$defs/ItineraryDay" },
          "description": "Per-day assignment of places."
        },
        "total_distance_km": {
          "type": "number",
          "minimum": 0,
          "description": "Total travel distance across the itinerary."
        },
        "optimization_method": {
          "type": "string",
          "minLength": 1,
          "description": "Name of the algorithm used to optimize the itinerary."
        },
        "generated_at": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the itinerary was produced."
        }
      },
      "required": ["days", "total_distance_km", "optimization_method"],
      "description": "Response payload returned by the ML service when an itinerary is optimized."
    }
  }
}
